<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>slider.js</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>slider.js</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Created July 16th 2012 by Vlad Yazhbin.  Twitter: <a href="http://twitter.com/vla">@vla</a></p>
<p>Slider is a sample game for GameThrone.js, my new HTML5 &amp; Javascript game engine.
Visit <a href="http://vlad.github.com/gamethrone">vlad.github.com/gamethrone</a> to play Slider or get more examples.</p>
<p>See the README in the GitHub repository for reasons why I made certain coding, algorithm, and UI decisions.
<a href="http://github.com/vlad/sliding-puzzle-game">github.com/vlad/sliding-puzzle-game</a></p>
<h1>Description</h1>
<p><strong>Slider</strong> is a sliding puzzle game where n tiles are laid out on a board x tiles wide and y tiles tall, where n is x * y - 1.
Tiles are numbered from 1 to n, so one possible arrangement is that of increasing order from the top-left to
the bottom-right, leaving the last square on the board empty.  This is the final state.
The player starts with a random arrangement of tiles and must slide tiles around the grid to reach the final state.</p>
<h1>Implementation</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>var slider is a Game object and contains objects named board = Board(...), input = GameInput(...), and view = GameHTML5View(...),
as well as init(...) and newRandomGame(...) functions.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">slider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">({</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>First, board is a new Board object with the following functions:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">board</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Board</span><span class="p">({</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>board.isTerminal() checks if the current state matches the winning state by simply comparing two corresponding arrays;</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">isTerminal</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">join</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">getWinState</span><span class="p">().</span><span class="nx">join</span><span class="p">();</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>board.randomize() repeatedly moves the blank square around the board anywhere except where it just came from;</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">randomize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">blank</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">blankIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
          <span class="p">,</span> <span class="nx">last</span>  <span class="o">=</span> <span class="p">{</span> <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">top</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span> <span class="nx">neighbors</span><span class="p">,</span> <span class="nx">randomNeighbor</span>
          <span class="p">,</span> <span class="nx">shuffles</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span>
        <span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">blankIndex</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">blank</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">blankIndex</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
          <span class="nx">blank</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">blankIndex</span> <span class="o">-</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">top</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>We must get a list of neighboring tiles at the blank tile's current location,
removing the location of the neighbor it swapped with last.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">shuffles</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">neighbors</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getNeighbors</span><span class="p">(</span><span class="nx">blank</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="p">{</span> <span class="nx">visitDiagonals</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">neighbor</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="nx">neighbor</span><span class="p">.</span><span class="nx">left</span> <span class="o">===</span> <span class="nx">last</span><span class="p">.</span><span class="nx">left</span> <span class="o">&amp;&amp;</span> <span class="nx">neighbor</span><span class="p">.</span><span class="nx">top</span> <span class="o">===</span> <span class="nx">last</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
            <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Then, the blank spot randomly swaps places with one of these neighbors.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">neighbors</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">randomNeighbor</span> <span class="o">=</span> <span class="nx">neighbors</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">neighbors</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">swap</span><span class="p">(</span><span class="nx">blank</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">randomNeighbor</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">randomNeighbor</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
              <span class="nx">last</span> <span class="o">=</span> <span class="nx">blank</span><span class="p">;</span>
              <span class="nx">blank</span> <span class="o">=</span> <span class="nx">randomNeighbor</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Cannot randomize: no empty square&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>board.reset(...) defines the width and height of the board and sets the initial state to the final state,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">squares</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getWinState</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>and board.getWinState() returns the final state.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">getWinState</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">lastBoardSize</span><span class="p">,</span> <span class="nx">cache</span><span class="p">;</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>The final state returns a cached result, which is re-calculated only if the board dimensions change.
Caching is easy and good because isTerminal() calls this function every time a player slides a tile.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">lastBoardSize</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">!==</span> <span class="nx">lastBoardSize</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Calculating new won state...&quot;</span><span class="p">);</span>
            <span class="nx">lastBoardSize</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">lastBoardSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">a</span><span class="p">){</span>
              <span class="k">return</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Using the cached won state...&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">cache</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">};</span>
      <span class="p">})()</span>
    <span class="p">}),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>The second object, slider.input = GameInput(...),</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">input</span><span class="o">:</span> <span class="k">new</span> <span class="nx">GameInput</span><span class="p">({</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>has an init() function to give us a chance to store a pointer to the Game object.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">game</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">;</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>We only need input.onSquareClick(...) because we don't support any other interaction from the player except
clicking on a square, for now.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">onSquareClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">board</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">board</span><span class="p">,</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">view</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">blank</span> <span class="o">=</span> <span class="nx">board</span><span class="p">.</span><span class="nx">getNeighbors</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="p">{</span> <span class="nx">visitDiagonals</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">neighbor</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">board</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">neighbor</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">neighbor</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">})[</span><span class="mi">0</span><span class="p">];</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>If we click any square that has a blank as one of its neighbors,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">blank</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>we swap the two squares and check if we've reached the final state.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="nx">board</span><span class="p">.</span><span class="nx">swap</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
          <span class="nx">view</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">);</span>
          <span class="nx">view</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="nx">blank</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">board</span><span class="p">.</span><span class="nx">isTerminal</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;YOU WON!&quot;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Finally, slider.view = GameHTML5View(...) has methods to draw on a canvas.  Like board and input, view also defines
additional functions:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">GameHTML5View</span><span class="p">({</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>view.calculateSquareSize() enables users to play larger puzzles with smaller-sized squares.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">calculateSquareSize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">squareSize</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">width</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">width</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">height</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">height</span><span class="p">));</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>view.init(...) initializes the canvas and sets up listeners for events that might come from other html
elements on the web page, such as button clicks.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">canvasId</span><span class="p">,</span> <span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">canvasId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">game</span> <span class="o">=</span> <span class="nx">game</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">attachHTML5Events</span><span class="p">(</span><span class="nx">events</span><span class="p">);</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>view.render() draws the game board;</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">board</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">board</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">top</span> <span class="o">&lt;</span> <span class="nx">board</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">top</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">board</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">left</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>view.renderSquare(...) performs the actual drawing of a square.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">renderSquare</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">board</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">board</span>
          <span class="p">,</span> <span class="nx">ctx</span>      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ctx</span>
          <span class="p">,</span> <span class="nx">ss</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">squareSize</span>
          <span class="p">,</span> <span class="nx">fontSize</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">ss</span> <span class="o">/</span> <span class="mf">2.5</span><span class="p">)</span>
          <span class="p">,</span> <span class="nx">value</span>    <span class="o">=</span> <span class="nx">board</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span>
        <span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="nx">left</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">top</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">ss</span><span class="p">,</span> <span class="nx">ss</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;#E00078&quot;</span><span class="p">;</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">left</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">top</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">ss</span><span class="p">,</span> <span class="nx">ss</span><span class="p">);</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;#FFD6F5&quot;</span><span class="p">;</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="nx">fontSize</span> <span class="o">+</span> <span class="s1">&#39;px Arial&#39;</span><span class="p">;</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">left</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">-</span> <span class="nx">fontSize</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">?</span> <span class="nx">fontSize</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">:</span> <span class="mi">0</span><span class="p">),</span>
                                   <span class="nx">top</span>  <span class="o">*</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ss</span> <span class="o">+</span> <span class="nx">fontSize</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>slider.init(...) calls one-time init() routines for its GameHTML5View and GameInput objects, but not for Board,
which doesn't have any one-time-only initializations to do.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">externalEvents</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">externalEvents</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>slider.newRandomGame(...) resets and randomizes the board and redraws the view!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">newRandomGame</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">randomize</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">calculateSquareSize</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Now that we created slider as our instance of Game(...), we want to call init(...).  We pass the id of our canvas
element, and the functions we want to use to handle interactions on our web page, such as canvas or button clicks.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">slider</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s1">&#39;slider&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">click</span><span class="o">:</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>When the user clicks the canvas element (id: 'canvas'),</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">slider</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">coordinates</span> <span class="o">=</span> <span class="nx">slider</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">getCoordinates</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">coordinates</span><span class="p">.</span><span class="nx">left</span> <span class="o">/</span> <span class="p">(</span><span class="nx">slider</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">squareSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
        <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">coordinates</span><span class="p">.</span><span class="nx">top</span> <span class="o">/</span> <span class="p">(</span><span class="nx">slider</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">squareSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>we automatically trigger input.onSquareClick(...)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">slider</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">inbounds</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">slider</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">onSquareClick</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>When the user clicks a quick game button (id: 'slider3x3' and similar), we launch a game of that size.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">slider3x3</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">slider</span><span class="p">.</span><span class="nx">newRandomGame</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">},</span>
      <span class="nx">slider4x4</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">slider</span><span class="p">.</span><span class="nx">newRandomGame</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">},</span>
      <span class="nx">slider5x5</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">slider</span><span class="p">.</span><span class="nx">newRandomGame</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Clicking the custom game button creates a new game of user-specified size.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">sliderCustomNew</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;sliderCustomHeight&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
          <span class="p">,</span>  <span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;sliderCustomWidth&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">;</span>
        <span class="nx">slider</span><span class="p">.</span><span class="nx">newRandomGame</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>We start a new random game before we leave the main function.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">slider</span><span class="p">.</span><span class="nx">newRandomGame</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <h1>GameThrone.js</h1>
<p><strong>Game Throne</strong> is a new game engine for board games written in Javascript by Vlad Yazhbin.  Two games are included:
Slider puzzle and Minesweeper, both of which render the game on an HTML5 canvas element.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>The <strong>Factory</strong> returns a new object of a given prototype with additional methods on it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Factory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prototypeObject</span><span class="p">,</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">methods</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nx">value</span><span class="o">:</span> <span class="nx">methods</span><span class="p">[</span><span class="nx">name</span><span class="p">]};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">prototypeObject</span><span class="p">,</span> <span class="nx">methods</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Board</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">squares</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">methods</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">Factory</span><span class="p">(</span><span class="nx">Board</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">};</span>
<span class="p">})();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p><strong>Board</strong> comes with many built-in functions:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">Board</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>forEachNeighbor(...) allows users to get neighboring squares in a functional way.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">forEachNeighbor</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">neighborOffsets</span> <span class="o">=</span>         <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">]]</span>
      <span class="p">,</span> <span class="nx">diagonalNeighborOffsets</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">conditions</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">conditions</span> <span class="o">=</span> <span class="nx">conditions</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="nx">conditions</span><span class="p">.</span><span class="nx">visitDiagonals</span> <span class="o">=</span> <span class="nx">conditions</span><span class="p">.</span><span class="nx">visitDiagonals</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">conditions</span><span class="p">.</span><span class="nx">visitDiagonals</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">testEachNeighbor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inbounds</span><span class="p">(</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">top</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">left</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">top</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">};</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>Neighbors to the top, right, bottom and left are checked automatically, but diagonal neighbors can be
checked as well if {visitDiagonals: true} is passed as a condition.  This is useful in a game like Minesweeper.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">neighborOffsets</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">testEachNeighbor</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">conditions</span><span class="p">.</span><span class="nx">visitDiagonals</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">diagonalNeighborOffsets</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">testEachNeighbor</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})(),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>get(...) returns the value of a given square,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inbounds</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">squares</span><span class="p">[</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">top</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Cannot return a value at position (&#39;</span> <span class="o">+</span> <span class="nx">left</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">top</span> <span class="o">+</span> <span class="s1">&#39;) because it is out of bounds&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>getNeighbors(...) loops through each neighbor and returns the list.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">getNeighbors</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">conditions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">neighbors</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">forEachNeighbor</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">neighbors</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">left</span><span class="o">:</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">t</span><span class="p">});</span>
    <span class="p">},</span> <span class="nx">conditions</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">neighbors</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>grid() prints out the board in text form.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">grid</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">s</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">i</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>inbounds(...) returns the validity of square locations.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">inbounds</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">top</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">left</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">&amp;&amp;</span> <span class="nx">top</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">&amp;&amp;</span> <span class="nx">left</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>set(...) sets the value of a square at a given location,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inbounds</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">squares</span><span class="p">[</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">top</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>and swap(...) swaps any two locations with each other.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">swap</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">left2</span><span class="p">,</span> <span class="nx">top2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">left2</span><span class="p">,</span> <span class="nx">top2</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">left2</span><span class="p">,</span> <span class="nx">top2</span><span class="p">,</span> <span class="nx">temp</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Game</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">methods</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">Factory</span><span class="p">(</span><span class="nb">Object</span><span class="p">,</span> <span class="nx">methods</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">GameHTML5View</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">canvas</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">game</span><span class="p">,</span> <span class="nx">squareSize</span><span class="p">;</span>

  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">methods</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">Factory</span><span class="p">(</span><span class="nx">GameHTML5View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">};</span>
<span class="p">})();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p><strong>GameHTML5View</strong> includes the following functions:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">GameHTML5View</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>attachHTML5Events(...) adds one or more event listeners in the form of { event_type: {  html_id:  handler(), ... }, ... },
such as { click: {'slider': function(...) ...}, ... }</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">attachHTML5Events</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">domId</span> <span class="k">in</span> <span class="nx">events</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onHTML5Event</span><span class="p">(</span><span class="nx">domId</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">events</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">domId</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>getCoordinates(...) returns the x, y coordinates of an event in the canvas</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">getCoordinates</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>we use event.offsetX and event.offsetY in Google Chrome,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">offsetX</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">offsetX</span><span class="p">;</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>event.x and event.y in many browsers,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">x</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>and client.x and client.y in Firefox.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">+</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">;</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">+</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">x</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">offsetLeft</span><span class="p">;</span>
      <span class="nx">y</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">left</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">y</span><span class="p">};</span>
  <span class="p">},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>onHTML5Event(...) sets up each individual listener in the DOM.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">onHTML5Event</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">func</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">GameInput</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">game</span><span class="p">;</span>

  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">methods</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">Factory</span><span class="p">(</span><span class="nb">Object</span><span class="p">,</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">};</span>
<span class="p">})();</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
